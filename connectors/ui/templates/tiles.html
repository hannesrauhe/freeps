{{$i := 0}}
{{$gridSize := 4}}
<link rel="stylesheet" href="/chota.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<div class="container">
	<div class="row">
{{ $sensors := flow_ExecuteOperator "sensor" "GetSensorPropertiesByAlias" "sensorCategory=Fritz_Dev&sensorPropertyName=targetTemperature&sensorPropertyName=temperature&sensorPropertyName=state&sensorPropertyName=AIN" }}
{{ $sensorMap := $sensors.Output}}
{{ range $sensorAlias, $value := $sensorMap }}
	{{ if or $value.targetTemperature $value.state }}
	{{ if divisibleBy $i $gridSize }}</div><div class="row">{{ end }}{{$i = add $i 1}}
		<div class="col">
			<header><h4>{{ $sensorAlias }} {{ if $value.temperature }} - {{ $value.temperature }} {{ end }} </h4></header>
		{{ if $value.targetTemperature }}
			<div style="margin: auto">

			<form action="/fritz/sethkrtsoll" method="GET" target="outputframe" style="display: flex; justify-content: center">
			<input style="width:80px;" type="number" name="param" min="16" max="56" value="{{ $value.targetTemperature }}" /> <!-- off by factor 2 -->
			<button name="ain" value="{{ $value.AIN }}">Set</button>
			</form>

			<form action="/fritz/sethkrtsoll" method="GET" target="outputframe">
			<input type="hidden" name="ain" value="{{ $value.AIN }}">
			<div style="display: flex; justify-content: center">
				<button name="param" value="32">16째C</button>
				<button name="param" value="38">19째C</button>
			</div>
			<div style="display: flex; justify-content: center">
				<button name="param" value="44">22째C</button>
				<button name="param" value="50">25째C</button>
			</div>
			</form>
			</div>
		{{ end}}

		{{ if $value.state }}
			<div style="margin: auto">

			<form action="/fritz/setsimpleonoff"  method="GET" target="outputframe">
			<input type="hidden" name="device" value="{{ $value.AIN }}">
			<div style="display: flex; justify-content: center">
				<button name="onoff" value="1">On</button>
				<button name="onoff" value="0">Off</button>
			</div>
			<div style="display: flex; justify-content: center">
				<button name="onoff" value="Toggle">Toggle</button>
			</div>
			</form>
			</div>
		{{ end}}
		</div>
	{{ end}}
{{ end}}

{{ range $key, $value := flow_GetFlowDescByTag "ui,tile" }}
	{{ if ne $key "devicelist" }}
	{{ if divisibleBy $i $gridSize }}</div><div class="row">{{ end }}{{$i = add $i 1}}
		<iframe name="tile-{{$key}}" class="col" src="/flow/{{$key}}"></iframe>
	{{end}}
{{end}}

{{ if divisibleBy $i $gridSize }}</div><div class="row">{{ end }}{{$i = add $i 1}}
		<iframe name="outputframe" id="outputframe" class="col"></iframe>
	</div>  <!--  row -->
</div><!--  container -->