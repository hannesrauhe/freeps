<link rel="stylesheet" href="/chota.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">


{{ $cat := "" }}
{{ $prop := "" }}
{{ $args := "" }}
{{ if .arguments.category }}
    {{ $cat = .arguments.category }}
    {{ $args = printf "SensorCategory=%s" $cat }}
{{ end }}
{{ if .arguments.property }}
    {{ $prop = .arguments.property }}
    {{ $args = printf "%s&SensorProperty=%s" $args $prop }}
{{ end }}
<div class="container">
<form method="GET" action="/ui/sensors.html"  class="row">
    <div class="col">
        <label for="category">Category</label>
        <select name="category" id="cat">
{{ $categories := flow_ExecuteOperator "sensor" "GetSensorCategories" ""}}
{{ range $key, $entry := $categories.Output }}
            <option value="{{$entry}}" {{ if eq $cat $entry }} selected {{end}}>{{$entry}}</option>
{{ end }}
        </select>
    </div>
    <div class="col">
        <label for="property">Property</label>
        <select name="property" id="prop">
            <option value="">All</option>
{{ $properties := flow_ExecuteOperator "sensor" "GetAllProperties" $args}}
{{ range $property, $sensor := $properties.Output }}
            <option value="{{$property}}" {{ if eq $prop $property }} selected {{end}}>{{$property}}</option>
{{ end }}
        </select>
    </div>
    <div class="col">
        <br />
        <input type="submit" />
    </div>
</form>
</div>

<table>
<tr><th>Alias</th><th>Properties</th></tr>
{{ $sensors := flow_ExecuteOperator "sensor" "GetSensorNames" $args}}
{{ range $key, $name := $sensors.Output }}
{{ $id := printf "%s.%s" $cat $name }}
    <tr>
        <!--<td><a href="/ui/sensors.html?category={{$cat}}">{{$cat}}</a>.test</td>-->
        {{ $nameArgs := printf "SensorName=%s&SensorCategory=%s" $name $cat }}
        {{ $sensorAlias := flow_ExecuteOperator "sensor" "GetSensorAlias" $nameArgs }}
        <td><a href="/ui/storeSingle.html?namespace=_sensors&key={{ $id }}" title="{{ $id }}"> {{ $sensorAlias.Output }} </a></td>
        {{ if eq $prop "" }}
        <td>
                {{ $sensorProps := flow_ExecuteOperator "sensor" "GetSensorProperties" $nameArgs }}
                {{ range $key, $property := $sensorProps.Output }}
                <a href="/ui/storeSingle.html?namespace=_sensors&key={{ $id }}.{{ $property }}">  {{ $property }} </a>
                {{ end }}
        </td>
        {{ else }}
        <td>
                {{ $propArgs := printf "SensorName=%s&SensorCategory=%s&PropertyName=%s" $name $cat $prop}}
                {{ $sensorProp := flow_ExecuteOperator "sensor" "GetSensorProperty" $propArgs }}
                <a href="/ui/storeSingle.html?namespace=_sensors&key={{ $id }}.{{ $prop }}">  {{ $sensorProp.Output }} </a>
        </td>
        {{ end }}
    </tr>
{{ end }}

</table>
